# Development Dockerfile for Agents service
# Enables hot-reload with ts-node-dev and debugging support
# Build: docker build -f Dockerfile.dev -t ableka-agents-dev .
# Run: docker-compose -f docker-compose.dev.yml up agents

FROM node:20.11-alpine

WORKDIR /app

# Install build tools and debugger tools
RUN apk add --no-cache \
    python3 \
    make \
    g++ \
    curl

# Copy package files
COPY package.json package-lock.json* ./

# Install dependencies (including dev dependencies for ts-node-dev)
RUN npm ci

# Copy source code
COPY src ./src
COPY tsconfig.json ./

# Expose ports
EXPOSE 3002 9229

# Health check
HEALTHCHECK --interval=30s --timeout=10s --retries=3 --start-period=30s \
  CMD curl -f http://localhost:3002/health || exit 1

# Run with ts-node-dev for hot-reload and debugging
CMD ["npx", "ts-node-dev", \
     "--inspect=0.0.0.0:9229", \
     "--respawn", \
     "--transpile-only", \
     "--ignore-watch", "node_modules", \
     "src/index.ts"]
